<!DOCTYPE HTML>
<html>
<% include header%>
    <head>
        <title>
            <%= title %>
        </title>
        <link href="./images/favicon.ico" rel="shortcut icon" />
        <link href="stylesheets/teacher.css" rel="stylesheet" type="text/css">
        <link href="stylesheets/page.css" rel="stylesheet" type="text/css">
        <style>
            /* html {
                height: 100%;
                min-height: 830px;
            }

            body {
                height: 100%;
            }

            #bottom {
                position: absolute;
                bottom: 0;
            } */
        </style>
    </head>

    <body>
        <!--以上为导航栏-->
        <div id="teacher_header_img"></div>
        <div class="main">
            <div class="right_report1">
                <h2>学生成绩表</h2>
                <div class="reportList">
                    <div class="headTop">
                        <div>
                            <span>实验批次：</span>
                            <select onchange="submitForm()" style="font-size:medium" id="year_sel" name="year_sel">
                                <% for(var d in year){%>
                                    <option>
                                        <%=year[d].year%>
                                    </option>
                                    <%}%>
                            </select>
                            <span>学生学号：</span>
                            <input type="search" id="studentnumber" />
                            <button type="button" class="btn btn-primary btn-sm" onclick="research()">搜 索</button>
                        </div>
                    </div>

                    <table class="table table-hover" id="table">
                        <tr>
                            <th>姓名</th>
                            <th>学号</th>
                            <th>实验1</th>
                            <th>实验2</th>
                            <th>实验3</th>
                            <th>实验4</th>
                            <th>实验5</th>
                            <th>实验6</th>
                            <th>实验7</th>
                            <th>实验8</th>
                            <th>实验9</th>
                        </tr>
                        <% for(var d in result){%>
                            <tr>
                                <td>
                                    <%=result[d].name%>
                                </td>
                                <td>
                                    <%=result[d].username%>
                                </td>
                                <td>
                                    <a href="scoreDetail?user_id=<%=result[d].user_id%>&year=<%=result[d].year%>&courseid=0" class="text-success">
                                        <% if ( (result[d].score.split(","))[0] <60 ){ %>
                                            <% } 
                                            else { %>
                                                <%=(result[d].score.split(","))[0]%>
                                                    <% } %>
                                    </a>
                                </td>
                                <td>
                                    <a href="scoreDetail?user_id=<%=result[d].user_id%>&year=<%=result[d].year%>&courseid=1" class="text-success">
                                        <% if ( (result[d].score.split(","))[1] <60 ){ %>
                                            <% } 
                                            else { %>
                                                <%=(result[d].score.split(","))[1]%>
                                                    <% } %>
                                    </a>
                                </td>
                                <td>
                                    <a href="scoreDetail?user_id=<%=result[d].user_id%>&year=<%=result[d].year%>&courseid=2" class="text-success">
                                        <% if ( (result[d].score.split(","))[2] <60 ){ %>
                                            <% } 
                                            else { %>
                                                <%=(result[d].score.split(","))[2]%>
                                                    <% } %>
                                    </a>
                                </td>
                                <td>
                                    <a href="scoreDetail?user_id=<%=result[d].user_id%>&year=<%=result[d].year%>&courseid=3" class="text-success">
                                        <% if ( (result[d].score.split(","))[3] <60 ){ %>
                                            <% } 
                                            else { %>
                                                <%=(result[d].score.split(","))[3]%>
                                                    <% } %>
                                    </a>
                                </td>
                                <td>
                                    <a href="scoreDetail?user_id=<%=result[d].user_id%>&year=<%=result[d].year%>&courseid=4" class="text-success">
                                        <% if ( (result[d].score.split(","))[4] <60 ){ %>
                                            <% } 
                                            else { %>
                                                <%=(result[d].score.split(","))[4]%>
                                                    <% } %>
                                    </a>
                                </td>
                                <td>
                                    <a href="scoreDetail?user_id=<%=result[d].user_id%>&year=<%=result[d].year%>&courseid=5" class="text-success">
                                        <% if ( (result[d].score.split(","))[5] <60 ){ %>
                                            <% } 
                                            else { %>
                                                <%=(result[d].score.split(","))[5]%>
                                                    <% } %>
                                    </a>
                                </td>
                                <td>
                                    <a href="scoreDetail?user_id=<%=result[d].user_id%>&year=<%=result[d].year%>&courseid=6" class="text-success">
                                        <% if ( (result[d].score.split(","))[6] <60 ){ %>
                                            <% } 
                                            else { %>
                                                <%=(result[d].score.split(","))[6]%>
                                                    <% } %>
                                    </a>
                                </td>
                                <td>
                                    <a href="scoreDetail?user_id=<%=result[d].user_id%>&year=<%=result[d].year%>&courseid=7" class="text-success">
                                        <% if ( (result[d].score.split(","))[7] <60 ){ %>
                                            <% } 
                                            else { %>
                                                <%=(result[d].score.split(","))[7]%>
                                                    <% } %>
                                    </a>
                                </td>
                                <td>
                                    <a href="scoreDetail?user_id=<%=result[d].user_id%>&year=<%=result[d].year%>&courseid=8" class="text-success">
                                        <% if ( (result[d].score.split(","))[8] <60 ){ %>
                                            <% } 
                                            else { %>
                                                <%=(result[d].score.split(","))[8]%>
                                                    <% } %>
                                    </a>
                                </td>
                            </tr>
                            <%}%>
                    </table>
                </div>
            </div>
            <div class="clearfix"></div>

        </div>

        <% include footer%>

            <script src="javascripts/bootstrap.js" type="text/javascript"></script>
            <script src="javascripts/jquery-1.12.3.min.js" type="text/javascript"></script>
            <script src="javascripts/paging.js" type="text/javascript"></script>
            <script>
                function research() {
                    var number = $("#studentnumber").val();
                    var year = $("#year_sel option:selected").val();
                    $.post('scoreTable/research', {
                        studentnumber: number,
                        year: year
                    }, function (data) {
                        var tab = document.getElementById("table");
                        $("#table tr:not(:first)").empty("");
                        if (data.length == 0) {
                            var tr = document.createElement("tr");
                            var td1 = document.createElement("td");
                            td1.innerHTML = "该学生暂无实验成绩";
                            tr.appendChild(td1);
                            tab.appendChild(tr);
                        }
                        else {
                            for (var i = 0; i < data.length; i++) {
                                var tabrow = insertScore(data[i]);
                                tab.appendChild(tabrow);
                                $('').addClass("text-danger");
                            }
                            $('tr').addClass("table-bordered");
                            $('td').addClass("expMessageCss");
                        }
                    })
                }
                function submitForm() {
                    var year = $("#year_sel option:selected").val();
                    $.post('scoreTable/getList', {
                        year: year,
                    }, function (data) {
                        var tab = document.getElementById("table");
                        $("#table tr:not(:first)").empty("");
                        for (var i = 0; i < data.length; i++) {
                            var tabrow = insertScore(data[i]);
                            tab.appendChild(tabrow);
                            $('').addClass("text-danger");
                        }
                        $('tr').addClass("table-bordered");
                        $('td').addClass("expMessageCss");
                        var sel_count = 0;
                        if (data.length) sel_count = data[0].count;
                        options = {
                            currentPage: 1,//初始页（选传，默认1）
                            pageSize: 15,//每页列表数
                            listTotal: sel_count,//列表总数（选传），不传为list总数
                            callback: function (currentPage) {//翻页回调（可填，可做ajax请求）,不传为纯html切换
                                ajaxDemo(currentPage)
                            }
                        }
                        $("#table").paging(options);
                    });
                };
                function insertScore(data) {
                    var tr = document.createElement("tr");
                    var td1 = document.createElement("td");
                    td1.innerHTML = data.name;
                    tr.appendChild(td1);

                    var td2 = document.createElement("td");
                    td2.innerHTML = data.username;
                    tr.appendChild(td2);

                    var td3 = document.createElement("td");
                    var a3 = document.createElement('a');
                    a3.href = "scoreDetail?user_id=" + data.user_id + "&year=" + data.year + "&courseid=0";
                    if((data.score.split(","))[0]>60)
                    a3.innerText =(data.score.split(","))[0];
                    else a3.innerText ="";
                    a3.setAttribute('class', 'text-success');
                    td3.appendChild(a3);
                    tr.appendChild(td3);

                    var td4 = document.createElement("td");
                    var a4 = document.createElement('a');
                    a4.href = "scoreDetail?user_id=" + data.user_id + "&year=" + data.year + "&courseid=1";
                    //a4.innerText = (data.score.split(","))[1] ? (data.score.split(","))[1] : "无";
                    if((data.score.split(","))[1]>60)
                    a4.innerText =(data.score.split(","))[1];
                    else a4.innerText ="";
                    a4.setAttribute('class', 'text-success');
                    td4.appendChild(a4);
                    tr.appendChild(td4);

                    var td5 = document.createElement("td");
                    var a5 = document.createElement('a');
                    a5.href = "scoreDetail?user_id=" + data.user_id + "&year=" + data.year + "&courseid=2";
                    if((data.score.split(","))[2]>60)
                    a5.innerText =(data.score.split(","))[2];
                    else a5.innerText ="";
                    a5.setAttribute('class', 'text-success');
                    td5.appendChild(a5);
                    tr.appendChild(td5);

                    var td6 = document.createElement("td");
                    var a6 = document.createElement('a');
                    a6.href = "scoreDetail?user_id=" + data.user_id + "&year=" + data.year + "&courseid=3";
                    if((data.score.split(","))[3]>60)
                    a6.innerText =(data.score.split(","))[3];
                    else a6.innerText ="";
                    a6.setAttribute('class', 'text-success');
                    td6.appendChild(a6);
                    tr.appendChild(td6);

                    var td7 = document.createElement("td");
                    var a7 = document.createElement('a');
                    a7.href = "scoreDetail?user_id=" + data.user_id + "&year=" + data.year + "&courseid=4";
                    if((data.score.split(","))[4]>60)
                    a7.innerText =(data.score.split(","))[4];
                    else a7.innerText ="";
                    a7.setAttribute('class', 'text-success');
                    td7.appendChild(a7);
                    tr.appendChild(td7);

                    var td8 = document.createElement("td");
                    var a8 = document.createElement('a');
                    a8.href = "scoreDetail?user_id=" + data.user_id + "&year=" + data.year + "&courseid=5";
                    if((data.score.split(","))[5]>60)
                    a8.innerText =(data.score.split(","))[5];
                    else a8.innerText ="";
                    a8.setAttribute('class', 'text-success');
                    td8.appendChild(a8);
                    tr.appendChild(td8);

                    var td9 = document.createElement("td");
                    var a9 = document.createElement('a');
                    a9.href = "scoreDetail?user_id=" + data.user_id + "&year=" + data.year + "&courseid=6";
                    if((data.score.split(","))[6]>60)
                    a9.innerText =(data.score.split(","))[6];
                    else a9.innerText ="";
                    a9.setAttribute('class', 'text-success');
                    td9.appendChild(a9);
                    tr.appendChild(td9);

                    var td10 = document.createElement("td");
                    var a10 = document.createElement('a');
                    a10.href = "scoreDetail?user_id=" + data.user_id + "&year=" + data.year + "&courseid=7";
                    if((data.score.split(","))[7]>60)
                    a10.innerText =(data.score.split(","))[7];
                    else a10.innerText ="";
                    a10.setAttribute('class', 'text-success');
                    td10.appendChild(a10);
                    tr.appendChild(td10);

                    var td11 = document.createElement("td");
                    var a11 = document.createElement('a');
                    a11.href = "scoreDetail?user_id=" + data.user_id + "&year=" + data.year + "&courseid=8";
                    if((data.score.split(","))[8]>60)
                    a11.innerText =(data.score.split(","))[8];
                    else a11.innerText ="";
                    a11.setAttribute('class', 'text-success');
                    td11.appendChild(a11);
                    tr.appendChild(td11);
                    return tr;
                }
                var load_count = '<%=count%>';
                var options = {
                    currentPage: 1,//初始页（选传，默认1）
                    pageSize: 15,//每页列表数
                    listTotal: load_count,//列表总数（选传），不传为list总数
                    callback: function (currentPage) {//翻页回调（可填，可做ajax请求）,不传为纯html切换
                        ajaxDemo(currentPage)
                    }
                }
                $("#table").paging(options);
                function ajaxDemo(page) {
                    var year = $("#year_sel option:selected").val();
                    $.post('scoreTable/getList', {
                        page: page,
                        year: year,
                    }, function (data) {
                        var tab = document.getElementById("table");
                        $("#table tr:not(:first)").empty("");
                        for (var i = 0; i < data.length; i++) {
                            var tabrow = insertScore(data[i]);
                            tab.appendChild(tabrow);
                            $('').addClass("text-danger");
                        }
                        $('tr').addClass("table-bordered");
                        $('td').addClass("expMessageCss");
                    });
                }
            </script>
    </body>

</html>